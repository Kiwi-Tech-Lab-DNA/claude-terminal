#!/usr/bin/env amber

// Claude Desktop Replacement - Interactive Menu
// This script provides an interactive menu for accessing Claude features
// Written in Amber for better readability and maintainability

import * from "std"

// Color definitions
let GREEN = "\033[0;32m"
let BLUE = "\033[0;34m"
let YELLOW = "\033[1;33m"
let RED = "\033[0;31m"
let NC = "\033[0m"

// Get script directory
fun get_script_dir(): Text {
    let result = $cd "$(dirname "${BASH_SOURCE[0]}")" && pwd$?
    return result as Text
}

// Function to display menu header
fun show_header() {
    $clear$?
    echo "{BLUE}‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ{NC}"
    echo "{GREEN}                     ü§ñ Claude Desktop Terminal{NC}"
    echo "{BLUE}‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ{NC}"
    echo ""
}

// Function to show menu using fzf if available
fun show_menu_fzf(): Text {
    let options = "üÜï New Chat\nüìã Recent Conversations\n‚èÆÔ∏è  Continue Last Conversation\n‚ùì Help\n‚ùå Exit"

    let result = $echo "{options}" | fzf --height=10 --layout=reverse --border=rounded --prompt="Select an option: " --header="What would you like to do?" --ansi 2>/dev/null$

    if status != 0 {
        return ""  // User cancelled
    }

    return result as Text
}

// Function to show menu using basic select
fun show_menu_basic(): Text {
    echo "{YELLOW}What would you like to do?{NC}"
    echo ""
    echo "1) New Chat"
    echo "2) Recent Conversations"
    echo "3) Continue Last Conversation"
    echo "4) Help"
    echo "5) Exit"
    echo ""

    echo -n "Please select an option (1-5): "
    let choice = input()

    if choice == "1" {
        return "üÜï New Chat"
    } else if choice == "2" {
        return "üìã Recent Conversations"
    } else if choice == "3" {
        return "‚èÆÔ∏è  Continue Last Conversation"
    } else if choice == "4" {
        return "‚ùì Help"
    } else if choice == "5" {
        return "‚ùå Exit"
    } else {
        return ""
    }
}

// Function to show help
fun show_help() {
    echo "{GREEN}Claude Desktop Terminal - Help{NC}"
    echo ""
    echo "This is a terminal-based interface for Claude that emulates Claude Desktop features."
    echo ""
    echo "{YELLOW}Menu Options:{NC}"
    echo "  ‚Ä¢ New Chat              - Start a fresh conversation with Claude"
    echo "  ‚Ä¢ Recent Conversations  - Browse and resume previous conversations"
    echo "  ‚Ä¢ Continue Last        - Quickly continue your most recent conversation"
    echo ""
    echo "{YELLOW}Command Line Usage:{NC}"
    echo "  ./claude-terminal.sh             - Show interactive menu (default)"
    echo "  ./claude-terminal.sh --new        - Start a new chat directly"
    echo "  ./claude-terminal.sh --recents    - Show recent conversations"
    echo "  ./claude-terminal.sh --continue   - Continue last conversation"
    echo ""
    echo "{YELLOW}Keyboard Shortcuts:{NC}"
    echo "  ‚Ä¢ Use arrow keys or numbers to navigate the menu"
    echo "  ‚Ä¢ Press Enter to select an option"
    echo "  ‚Ä¢ Press Ctrl+C to exit at any time"
    echo ""
    echo "Press Enter to return to the main menu..."
    input()
}

// Main menu loop
fun main_menu() {
    let script_dir = get_script_dir()

    loop {
        show_header()

        // Check if fzf is available
        let choice = if $command -v fzf >/dev/null 2>&1$? {
            show_menu_fzf()
        } else {
            show_menu_basic()
        }

        if choice == "üÜï New Chat" {
            echo "{GREEN}Starting new chat...{NC}"
            $cd "{script_dir}"$?
            $claude$?
            echo ""
            echo "{YELLOW}Claude session ended. Press Enter to return to menu...{NC}"
            input()

        } else if choice == "üìã Recent Conversations" {
            echo "{GREEN}Loading recent conversations...{NC}"
            $"{script_dir}/claude-recents.sh"$?
            echo ""
            echo "{YELLOW}Press Enter to return to menu...{NC}"
            input()

        } else if choice == "‚èÆÔ∏è  Continue Last Conversation" {
            echo "{GREEN}Continuing last conversation...{NC}"
            $cd "{script_dir}"$?
            $claude --continue$?
            echo ""
            echo "{YELLOW}Claude session ended. Press Enter to return to menu...{NC}"
            input()

        } else if choice == "‚ùì Help" {
            show_help()

        } else if choice == "‚ùå Exit" {
            echo "{GREEN}Goodbye!{NC}"
            exit(0)

        } else {
            echo "{YELLOW}Cancelled{NC}"
            exit(0)
        }
    }
}

// Entry point
main {
    main_menu()
}